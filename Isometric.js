'use strict';var _slicedToArray=function(){function a(b,d){var f=[],g=!0,j=!1,k=void 0;try{for(var m,l=b[Symbol.iterator]();!(g=(m=l.next()).done)&&(f.push(m.value),!(d&&f.length===d));g=!0);}catch(o){j=!0,k=o}finally{try{!g&&l['return']&&l['return']()}finally{if(j)throw k}}return f}return function(b,d){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,d);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_createClass=function(){function a(b,d){for(var g,f=0;f<d.length;f++)g=d[f],g.enumerable=g.enumerable||!1,g.configurable=!0,'value'in g&&(g.writable=!0),Object.defineProperty(b,g.key,g)}return function(b,d,f){return d&&a(b.prototype,d),f&&a(b,f),b}}();function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,d=Array(a.length);b<a.length;b++)d[b]=a[b];return d}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var Isometric=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window.innerWidth,f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:window.innerHeight;_classCallCheck(this,a),this._selectedNum=null,this._dragging=!1,this.board=b,this.size=Math.min(d/b,2*f/b),this._origin=[0.5*d-0.5*b*this.size,0.5*f],this.svg=document.createElementNS(SVG.NS,'svg'),this.svg.setAttribute('viewBox','0 0 '+d+' '+f),this.svg.setAttribute('width',d+'px'),this.svg.setAttribute('height',f+'px'),d>f?(this._maxZ=this.board,this.svg.style.marginTop='-2.5rem'):this._maxZ=2*this.board,document.body.appendChild(this.svg),this._control=new Control(this.svg,0.35*this.size),this._addEventListeners()}return _createClass(a,[{key:'addShove',value:function addShove(_ref,j){var b=_ref.x,d=_ref.y,f=_ref.w,g=_ref.h,p=b+f+0.2,q=200;g=Math.min(g,this._maxZ);var r=this._getLeftWall(p,d,g,q,!0);r.setAttribute('opacity',0.75);var s=document.createElementNS(SVG.NS,'line'),_getCoord=this.getCoord(p,d+0.5),_getCoord2=_slicedToArray(_getCoord,2),k=_getCoord2[0],l=_getCoord2[1],_getCoord3=this.getCoord(p+1.5,d+0.5),_getCoord4=_slicedToArray(_getCoord3,2),m=_getCoord4[0],o=_getCoord4[1],t=l-g*(0.25*this.size),u=o-g*(0.25*this.size);s.setAttribute('x1',k),s.setAttribute('y1',t),s.setAttribute('x2',m),s.setAttribute('y2',u),s.setAttribute('stroke','hsla('+q+', 100%, 30%, 0.75)'),s.setAttribute('stroke-width',2),j.appendChild(r),j.appendChild(s),j.setAttribute('pointerEvents','none')}},{key:'getShove',value:function getShove(_ref2){var b=_ref2.x,d=_ref2.y,f=_ref2.w,g=_ref2.h,j=document.createElementNS(SVG.NS,'g');return this.addShove({x:b,y:d,w:f,h:g},j),j}},{key:'updateShove',value:function updateShove(_ref3,j){var b=_ref3.x,d=_ref3.y,f=_ref3.w,g=_ref3.h;[].concat(_toConsumableArray(j.children)).forEach(function(k){return j.removeChild(k)}),this.addShove({x:b,y:d,w:f,h:g},j)}},{key:'getTile',value:function getTile(_ref4){var b=_ref4.x,d=_ref4.y,_ref4$fill=_ref4.fill,f=void 0===_ref4$fill?'none':_ref4$fill,_ref4$stroke=_ref4.stroke,g=void 0===_ref4$stroke?'lightgrey':_ref4$stroke,l=document.createElementNS(SVG.NS,'polygon');l.setAttribute('points','\n        0,0 \n        '+0.5*this.size+','+0.25*-this.size+' \n        '+this.size+',0 \n        '+0.5*this.size+','+0.25*this.size),l.setAttribute('fill',f),l.setAttribute('stroke',g);var _getCoord5=this.getCoord(b,d),_getCoord6=_slicedToArray(_getCoord5,2),j=_getCoord6[0],k=_getCoord6[1];return l.style.transform='translate('+j+'px,'+k+'px)',l}},{key:'_getLeftWall',value:function _getLeftWall(b,d,f,g){for(var m,j=4<arguments.length&&void 0!==arguments[4]&&arguments[4],k=document.createElementNS(SVG.NS,'g'),l=0;l<f;l++){m=document.createElementNS(SVG.NS,'polygon'),m.setAttribute('points','0,0 \n        0,'+0.5*-this.size+' \n        '+0.5*this.size+','+0.25*-this.size+'\n        '+0.5*this.size+','+0.25*this.size);var o=j?0:20;m.setAttribute('fill','hsl('+g+', 75%, '+(65+o)+'%)'),m.setAttribute('stroke','hsl('+g+', 100%, '+(20+o)+'%)');var _getCoord7=this.getCoord(b+l,d-l),_getCoord8=_slicedToArray(_getCoord7,2),r=_getCoord8[0],s=_getCoord8[1];m.style.transform='translate('+r+'px,'+s+'px)',k.appendChild(m)}return k}},{key:'_getRightWall',value:function _getRightWall(b,d,f,g){for(var m,j=4<arguments.length&&void 0!==arguments[4]&&arguments[4],k=document.createElementNS(SVG.NS,'g'),l=0;l<f;l++){m=document.createElementNS(SVG.NS,'polygon'),m.setAttribute('points','\n        '+0.5*this.size+','+0.25*this.size+' \n        '+0.5*this.size+','+0.25*-this.size+' \n        '+this.size+','+0.5*-this.size+'\n        '+this.size+',0');var o=j?0:20;m.setAttribute('fill','hsl('+g+', 75%, '+(35+o)+'%)'),m.setAttribute('stroke','hsl('+g+', 100%, '+(20+o)+'%)');var r=this.getCoord(b+l,d-l);m.style.transform='translate('+r[0]+'px,'+r[1]+'px)',k.appendChild(m)}return k}},{key:'_getTop',value:function _getTop(b,d,f,g){var j=4<arguments.length&&void 0!==arguments[4]&&arguments[4],k=document.createElementNS(SVG.NS,'polygon');k.setAttribute('points','0,0 \n      '+0.5*this.size+','+0.25*-this.size+' \n      '+this.size+',0 \n      '+0.5*this.size+','+0.25*this.size);var l=j?0:20;k.setAttribute('fill','hsl('+g+', 75%, '+(50+l)+'%)'),k.setAttribute('stroke','hsl('+g+', 100%, '+(20+l)+'%)');var p=this.getCoord(b,d);return k.style.transform='translate('+p[0]+'px,'+(p[1]-0.5*(f*this.size))+'px)',k}},{key:'getBlock',value:function getBlock(b,d,f){var g=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,j=4<arguments.length&&void 0!==arguments[4]&&arguments[4],k=document.createElementNS(SVG.NS,'g');f=Math.min(f,this._maxZ);var l=this._getLeftWall(b,d,f,g,j);k.appendChild(l);var m=this._getRightWall(b,d,f,g,j);k.appendChild(m);var o=this._getTop(b,d,f,g,j);return k.appendChild(o),k}},{key:'addBlocks',value:function addBlocks(_ref5,l){for(var o,b=_ref5.x,d=_ref5.y,f=_ref5.w,g=_ref5.h,j=_ref5.hue,k=_ref5.selected,m=f-1;0<=m;m--)o=this.getBlock(b+m,d,g,j,k),l.appendChild(o)}},{key:'updateBlocks',value:function updateBlocks(_ref6,l){var b=_ref6.x,d=_ref6.y,f=_ref6.w,g=_ref6.h,j=_ref6.hue,k=_ref6.selected;[].concat(_toConsumableArray(l.children)).forEach(function(m){return l.removeChild(m)}),this.addBlocks({x:b,y:d,w:f,h:g,hue:j,selected:k},l)}},{key:'getBlocks',value:function getBlocks(_ref7){var b=_ref7.x,d=_ref7.y,f=_ref7.w,g=_ref7.h,j=_ref7.hue,k=_ref7.selected,l=document.createElementNS(SVG.NS,'g');return this.addBlocks({x:b,y:d,w:f,h:g,hue:j,selected:k},l),l}},{key:'getCoord',value:function getCoord(b,d){return[this._origin[0]+0.5*((b+d)*this.size),this._origin[1]+0.25*((d-b)*this.size)]}},{key:'_start',value:function _start(b){this._dragging||(this._dragging=!0,this._update(b.detail))}},{key:'_update',value:function _update(b){if(this._dragging){var d=InputEvents.getPoint(b);this._maxZ===this.board&&(d.y+=40),this._control.update(d),this._control.anchor=nums[this._selectedNum].shoveCoords,nums[this._selectedNum].updateWidth(this._control.deltaX),this.svg.dispatchEvent(new CustomEvent('update',{bubbles:!0,detail:nums[this._selectedNum].props}))}}},{key:'_end',value:function _end(b){this._dragging&&(this._dragging=!1,nums[this._selectedNum].updateArea(),this._update(b),this._control.anchor=nums[this._selectedNum].shoveCoords,this._control.reset(),this.svg.dispatchEvent(new CustomEvent('update',{bubbles:!0,detail:nums[this._selectedNum].props})))}},{key:'_deselect',value:function _deselect(){this._selectedNum&&(nums[this._selectedNum].toggleSelect(),this._control.toggleVisibility(),this._selectedNum=null)}},{key:'_handleSelect',value:function _handleSelect(b){var d=b.detail;if(this._selectedNum===d)this._selectedNum=null,this._dragging=!1;else{this._selectedNum=d;var f=nums[d].shoveCoords;this._control.anchor=f,this._control.update(f)}this._control.toggleVisibility()}},{key:'_addEventListeners',value:function _addEventListeners(){var b=InputEvents.EVENTS;this._start=this._start.bind(this),this._update=this._update.bind(this),this._end=this._end.bind(this),this._deselect=this._deselect.bind(this),this._handleSelect=this._handleSelect.bind(this),this.svg.addEventListener('start-drag',this._start),this.svg.addEventListener(b.move,this._update),this.svg.addEventListener(b.up,this._end),this.svg.addEventListener(b.cancel,this._end),this.svg.addEventListener('toggle-select',this._handleSelect)}}]),a}();